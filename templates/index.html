<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="{{ url_for('static', filename='bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    <title>Network Simulation Dashboard</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
  </head>
  <body>
    <div class="py-4">
      <div class="card shadow-sm mb-4">
        <div class="card-body text-center">
          <h1 class="display-5 fw-bold mb-2">Network Simulation Dashboard</h1>
          <p class="text-muted mb-0">Hover over nodes to view routes or click on empty space to add a node.</p>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-lg-3">
          <div class="card shadow-sm">
            <div class="card-header fw-semibold">Simulation Controls</div>
            <div class="card-body">
              <form id="control-form">
                <div class="mb-3">
                  <label class="form-label">Number of Nodes: <span id='num-nodes-label'>{{state.n}}</span></label>
                  <input type="range" class="form-range" id="num-nodes" value="{{state.n}}" min="1" max="30">
                </div>
                <div class="mb-3">
                  <label class="form-label">Connection Range (km)</label>
                  <input type="number" class="form-control" id="connection-range" value="{{state.connection_range_km}}" step="0.1" readonly disabled>
                </div>
                <div class="mb-3">
                  <label class="form-label">Spreading Factor (SF)</label>
                  <select class="form-select" id="sf">
                    <option value="7" {% if state.sf == 7 %}selected{% endif %}>SF7</option>
                    <option value="8" {% if state.sf == 8 %}selected{% endif %}>SF8</option>
                    <option value="9" {% if state.sf == 9 %}selected{% endif %}>SF9</option>
                    <option value="10" {% if state.sf == 10 %}selected{% endif %}>SF10</option>
                    <option value="11" {% if state.sf == 11 %}selected{% endif %}>SF11</option>
                    <option value="12" {% if state.sf == 12 %}selected{% endif %}>SF12</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">TX Power (dBm)</label>
                  <input type="number" class="form-control" id="tx-power" value="{{state.tx_power_dbm}}" step="1">
                </div>
                <div class="mb-3">
                  <label class="form-label">
                    Path Loss Exponent
                    <input type="number" class="form-control" id="path-loss-exponent" value="{{state.path_loss_exponent}}" step="0.05">
                  </label>
                </div>
                <div class="mb-3">
                  <label class="form-label">Total Area Length (km)</label>
                  <input type="number" class="form-control" id="area-length" value="{{state.size_km}}" step="0.1">
                </div>
                <div class="mb-3">
                  <label class="form-label">
                    Routing Timer Interval (s)
                  </label>
                  <input type="number" class="form-control" id="routing-interval" value="{{state.routing_interval}}" step="1">
                </div>
                <div class="mb-3">
                  <label class="form-label">
                    Data Message Interval (s)
                  </label>
                  <input type="number" class="form-control" id="data-interval" value="{{state.data_interval}}" step="1">
                </div>
                <div class="mb-3">
                  <label class="form-label">
                    ReRoute on New Node?
                  </label>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="reroute-switch" {% if state.reroute_on_new_node %}checked{% endif %}>
                    <label class="form-check-check-label" for="reroute-switch">{{ 'Yes' if state.reroute_on_new_node else 'No' }}</label>
                  </div>
                </div>
              <!-- duration of simulation and interval for new node -->
              <div class="mb-3">
                <label class="form-label">Simulation Duration (s)</label>
                <input type="number" class="form-control" id="sim-duration" value="1800" step="10">
              </div>
              <div class="mb-3">
                <label class="form-label">New Node Addition Interval (s)</label>
                <input type="number" class="form-control" id="new-node-interval" value="60" step="10">
              </div>
              <!-- check for simulation -->
               <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="enable-simulation">
                <label class="form-check-check-label" for="enable-simulation">Enable New Node Addition Simulation</label>
              </div>
              <div class="d-flex gap-2">
                <button id="update-button" class="btn btn-primary w-100">Update</button>
                <button id="reset-button" class="btn btn-danger w-100">Reset</button>
              </div>
            </form>
          </div>
        </div>
      </div>

        <div class="col-lg-9">
          <div class="row g-3">
            <div class="col-lg-8">
              <div class="card shadow-sm">
                <div class="card-header fw-semibold">Simulation Canvas</div>
                <div class="card-body p-0">
                  <div id="canvas-wrap" class="bg-white">
                    <svg id="svg" class="bg-white border border-1"></svg>
                    <div id="tooltip"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-lg-4">
              <div class="card shadow-sm">
                <div class="card-header fw-semibold">Nodes</div>
                <div class="card-body vh-100 p-2 overflow-auto">
                  <div id="nodes-list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- allover statistics -->
    <div class="container">
      <div class="card shadow-sm mb-4">
        <div class="card-header fw-semibold">Simulation Statistics</div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <strong>Total Messages Sent:</strong> {{ state.total_messages_sent }}
            </li>
            <li class="list-group-item">
              <strong>Total Messages Received:</strong> {{ state.total_messages_received }}
            </li>
            <li class="list-group-item">
              <strong>Average Time to Deliver (s):</strong> {{ state.average_time_to_deliver }}
            </li>
            <li class="list-group-item">
              <strong>Total Routes Broadcasted:</strong> {{ state.total_routes_broadcasted }}
            </li>
            <li class="list-group-item">
              <strong>Average New Node Discovery Time (s):</strong> {{ state.average_new_node_discovery_time }}
            </li>
            <li class="list-group-item">
              <strong>New Nodes Added:</strong> {{ state.new_nodes_added }}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static', filename='socket.io.min.js')}}"></script>
    <script>

      // All the constants which were being passed as a template variable
      const state = {
        n                   : {{ state.n }},
        sf                  : {{ state.sf }},
        size_km             : {{ state.size_km }},
        tx_power_dbm        : {{ state.tx_power_dbm }},
        connection_range_km : {{ state.connection_range_km }},
        path_loss_exponent  : {{ state.path_loss_exponent }},
      };
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  </body>
</html>
